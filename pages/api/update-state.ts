import type { NextApiRequest, NextApiResponse } from 'next'
import Ably from "ably/promises"
import { ablyApiKey } from '../../common-api'
import { channelName, messageName } from '../../common'

const ablyClient = new Ably.Realtime(ablyApiKey)
const channel = ablyClient.channels.get(channelName)

export default function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const newState = {
    lastUpdateUserId: req.query.userId ?? null,
    timestamp: new Date().toISOString(),
    bloat: '3734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438373455405284243837345540528424383734554052842438'
  }
  channel.publish(messageName, newState)
  res.end()
}
